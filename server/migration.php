<?php
  require_once "model/response.php";
  require_once "model/database.php";
  require_once "model/logger.php";

  // update dates of matches

  Response::create(function($dtoIn) {
    $str = '[
                                      {
                                        "idD": 44,
                                        "idH": 47,
                                        "date": "2018-03-17 15:00:00"
                                      },
                                      {
                                        "idD": 44,
                                        "idH": 4,
                                        "date": "2018-03-31 15:00:00"
                                      },
                                      {
                                        "idD": 35,
                                        "idH": 21,
                                        "date": "2018-04-01 15:00:00"
                                      },
                                      {
                                        "idD": 43,
                                        "idH": 1,
                                        "date": "2018-04-01 15:00:00"
                                      },
                                      {
                                        "idD": 2,
                                        "idH": 54,
                                        "date": "2018-04-01 15:00:00"
                                      },
                                      {
                                        "idD": 48,
                                        "idH": 28,
                                        "date": "2018-04-01 15:00:00"
                                      },
                                      {
                                        "idD": 21,
                                        "idH": 44,
                                        "date": "2018-04-07 16:30:00"
                                      },
                                      {
                                        "idD": 4,
                                        "idH": 48,
                                        "date": "2018-04-07 16:30:00"
                                      },
                                      {
                                        "idD": 54,
                                        "idH": 47,
                                        "date": "2018-04-08 13:30:00"
                                      },
                                      {
                                        "idD": 1,
                                        "idH": 35,
                                        "date": "2018-04-08 16:30:00"
                                      },
                                      {
                                        "idD": 28,
                                        "idH": 2,
                                        "date": "2018-04-08 16:30:00"
                                      },
                                      {
                                        "idD": 47,
                                        "idH": 28,
                                        "date": "2018-04-15 16:30:00"
                                      },
                                      {
                                        "idD": 2,
                                        "idH": 4,
                                        "date": "2018-04-15 16:30:00"
                                      },
                                      {
                                        "idD": 48,
                                        "idH": 21,
                                        "date": "2018-04-15 16:30:00"
                                      },
                                      {
                                        "idD": 44,
                                        "idH": 1,
                                        "date": "2018-04-15 16:30:00"
                                      },
                                      {
                                        "idD": 35,
                                        "idH": 43,
                                        "date": "2018-04-15 16:30:00"
                                      },
                                      {
                                        "idD": 21,
                                        "idH": 2,
                                        "date": "2018-04-21 17:00:00"
                                      },
                                      {
                                        "idD": 4,
                                        "idH": 47,
                                        "date": "2018-04-21 17:00:00"
                                      },
                                      {
                                        "idD": 28,
                                        "idH": 54,
                                        "date": "2018-04-21 17:00:00"
                                      },
                                      {
                                        "idD": 43,
                                        "idH": 44,
                                        "date": "2018-04-22 17:00:00"
                                      },
                                      {
                                        "idD": 1,
                                        "idH": 48,
                                        "date": "2018-04-22 17:00:00"
                                      },
                                      {
                                        "idD": 44,
                                        "idH": 35,
                                        "date": "2018-04-28 17:00:00"
                                      },
                                      {
                                        "idD": 54,
                                        "idH": 4,
                                        "date": "2018-04-29 14:00:00"
                                      },
                                      {
                                        "idD": 47,
                                        "idH": 21,
                                        "date": "2018-04-29 17:00:00"
                                      },
                                      {
                                        "idD": 2,
                                        "idH": 1,
                                        "date": "2018-04-29 17:00:00"
                                      },
                                      {
                                        "idD": 48,
                                        "idH": 43,
                                        "date": "2018-04-29 17:00:00"
                                      },
                                      {
                                        "idD": 43,
                                        "idH": 2,
                                        "date": "2018-05-05 17:00:00"
                                      },
                                      {
                                        "idD": 1,
                                        "idH": 47,
                                        "date": "2018-05-05 17:00:00"
                                      },
                                      {
                                        "idD": 21,
                                        "idH": 54,
                                        "date": "2018-05-05 17:00:00"
                                      },
                                      {
                                        "idD": 4,
                                        "idH": 28,
                                        "date": "2018-05-06 17:00:00"
                                      },
                                      {
                                        "idD": 35,
                                        "idH": 48,
                                        "date": "2018-05-06 17:00:00"
                                      },
                                      {
                                        "idD": 54,
                                        "idH": 1,
                                        "date": "2018-05-13 14:00:00"
                                      },
                                      {
                                        "idD": 47,
                                        "idH": 43,
                                        "date": "2018-05-13 17:00:00"
                                      },
                                      {
                                        "idD": 2,
                                        "idH": 35,
                                        "date": "2018-05-13 17:00:00"
                                      },
                                      {
                                        "idD": 48,
                                        "idH": 44,
                                        "date": "2018-05-13 17:00:00"
                                      },
                                      {
                                        "idD": 28,
                                        "idH": 21,
                                        "date": "2018-05-13 17:00:00"
                                      },
                                      {
                                        "idD": 35,
                                        "idH": 47,
                                        "date": "2018-05-19 17:00:00"
                                      },
                                      {
                                        "idD": 43,
                                        "idH": 54,
                                        "date": "2018-05-19 17:00:00"
                                      },
                                      {
                                        "idD": 1,
                                        "idH": 28,
                                        "date": "2018-05-20 17:00:00"
                                      },
                                      {
                                        "idD": 21,
                                        "idH": 4,
                                        "date": "2018-05-20 17:00:00"
                                      },
                                      {
                                        "idD": 44,
                                        "idH": 2,
                                        "date": "2018-05-20 17:00:00"
                                      },
                                      {
                                        "idD": 1,
                                        "idH": 4,
                                        "date": "2018-05-26 17:00:00"
                                      },
                                      {
                                        "idD": 47,
                                        "idH": 44,
                                        "date": "2018-05-26 17:00:00"
                                      },
                                      {
                                        "idD": 54,
                                        "idH": 35,
                                        "date": "2018-05-27 14:00:00"
                                      },
                                      {
                                        "idD": 2,
                                        "idH": 48,
                                        "date": "2018-05-27 17:00:00"
                                      },
                                      {
                                        "idD": 28,
                                        "idH": 43,
                                        "date": "2018-05-27 17:00:00"
                                      },
                                      {
                                        "idD": 44,
                                        "idH": 54,
                                        "date": "2018-06-02 17:00:00"
                                      },
                                      {
                                        "idD": 35,
                                        "idH": 28,
                                        "date": "2018-06-02 17:00:00"
                                      },
                                      {
                                        "idD": 1,
                                        "idH": 21,
                                        "date": "2018-06-02 17:00:00"
                                      },
                                      {
                                        "idD": 43,
                                        "idH": 4,
                                        "date": "2018-06-03 17:00:00"
                                      },
                                      {
                                        "idD": 48,
                                        "idH": 47,
                                        "date": "2018-06-03 17:00:00"
                                      },
                                      {
                                        "idD": 28,
                                        "idH": 44,
                                        "date": "2018-06-09 17:00:00"
                                      },
                                      {
                                        "idD": 54,
                                        "idH": 48,
                                        "date": "2018-06-10 14:00:00"
                                      },
                                      {
                                        "idD": 47,
                                        "idH": 2,
                                        "date": "2018-06-10 17:00:00"
                                      },
                                      {
                                        "idD": 21,
                                        "idH": 43,
                                        "date": "2018-06-10 17:00:00"
                                      },
                                      {
                                        "idD": 4,
                                        "idH": 35,
                                        "date": "2018-06-10 17:00:00"
                                      }
                                    ]';

    $arr = json_decode($str, true);
    $res = array();

    foreach ($arr as $match) {
      $result = Database::getOne(sprintf("SELECT id, datum FROM zapas WHERE idD = %d AND idH = %d ORDER BY datum DESC", $match["idD"], $match["idH"]));
      if ($result["datum"] != $match["date"]) {
        $res[] = sprintf("UPDATE zapas SET datum='%s' where id=%d", $match["date"], $result["id"]);
      }
    }

    return join(";", $res);
  });
?>
